<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ad Site (A) â†’ Shop Site (B) Cross-domain Tracking Test</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; padding: 16px; line-height: 1.5; }
      .row { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; }
      button, a.btn {
        display: inline-block; padding: 10px 14px; border-radius: 10px; border: 0;
        background: #2d6cdf; color: #fff; font-weight: 650; cursor: pointer; text-decoration: none;
      }
      button.secondary, a.secondary { background: #6c757d; }
      #out { margin-top: 12px; padding: 12px; border: 1px solid #e5e5e5; border-radius: 10px; word-break: break-word; }
      code { background: #f6f8fa; padding: 2px 6px; border-radius: 6px; }
      input { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #ddd; }
      small { color: #666; }
    </style>
  </head>
  <body>
    <h1>ç½‘ç«™ Aï¼ˆå¹¿å‘Šé¡µ / Vercelï¼‰</h1>
    <p>
      æœ¬é¡µä¼šåœ¨ <code>localStorage</code> å†™å…¥ <code>tracker_id</code>ï¼Œç„¶åè·³è½¬åˆ°ç½‘ç«™ Bï¼ˆGitHub Pagesï¼‰ã€‚
      <br />
      æ³¨æ„ï¼š<b>è·¨åŸŸæ—¶ï¼Œç½‘ç«™ B æ­£å¸¸æƒ…å†µä¸‹è¯»ä¸åˆ°ç½‘ç«™ A çš„ localStorage/cookie</b>ï¼›ç°å®é‡Œçš„â€œè·¨åŸŸè¿½è¸ªâ€é€šå¸¸é  URL å‚æ•°/é‡å®šå‘ç­‰æ‰‹æ®µã€‚
    </p>

    <p>
      å½“å‰ Originï¼š<code id="origin"></code><br />
      å½“å‰ tracker_idï¼ˆæœ¬åŸŸ localStorageï¼‰ï¼š<code id="currentId">(none)</code>
    </p>

    <label for="target">ç½‘ç«™ Bï¼ˆshop-siteï¼‰URLï¼ˆå¯æ”¹ï¼‰ï¼š</label>
    <input id="target" />
    <small>é»˜è®¤å¡«ï¼šä½ çš„ GitHub Pages `test.html`ï¼ˆåŒä¸€ä¸ªäººç‚¹å‡»åŒä¸€æ¡é“¾æ¥å³å¯ï¼‰</small>

    <div class="row">
      <button onclick="ensureId()">ç”Ÿæˆ/å¤ç”¨ tracker_id</button>
      <button class="secondary" onclick="rotateId()">å¼ºåˆ¶ç”Ÿæˆæ–° tracker_id</button>
      <button onclick="go(false)">è·³è½¬åˆ°ç½‘ç«™Bï¼ˆä¸å¸¦å‚æ•°ï¼‰</button>
      <button onclick="go(true)">è·³è½¬åˆ°ç½‘ç«™Bï¼ˆå¸¦ ?tid=... å‚æ•°ï¼‰</button>
      <button class="secondary" onclick="clearAll()">æ¸…é™¤æœ¬åŸŸ tracker_id</button>
    </div>

    <div id="out">ç­‰å¾…æ“ä½œâ€¦</div>

    <script>
      const KEY = "tracker_id";
      const DEFAULT_TARGET = "https://1karess.github.io/reddit-webview-pool-test/test.html";

      document.getElementById("origin").textContent = window.location.origin;
      const targetEl = document.getElementById("target");
      targetEl.value = DEFAULT_TARGET;

      function newId() {
        return "A_" + Date.now() + "_" + Math.random().toString(36).slice(2, 10);
      }

      function refreshCurrentId() {
        document.getElementById("currentId").textContent = localStorage.getItem(KEY) || "(none)";
      }

      function ensureId() {
        let id = localStorage.getItem(KEY);
        if (!id) {
          id = newId();
          localStorage.setItem(KEY, id);
        }
        refreshCurrentId();
        document.getElementById("out").innerHTML =
          "âœ… A å½“å‰ tracker_id: <b>" + id + "</b><br>KEY=" + KEY;
        return id;
      }

      function rotateId() {
        const id = newId();
        localStorage.setItem(KEY, id);
        refreshCurrentId();
        document.getElementById("out").innerHTML =
          "ğŸ” A å·²å¼ºåˆ¶æ›´æ–° tracker_id: <b>" + id + "</b><br>KEY=" + KEY;
        return id;
      }

      function go(withParam) {
        const id = ensureId();
        let url = (targetEl.value || DEFAULT_TARGET).trim();
        try {
          const u = new URL(url);
          if (withParam) u.searchParams.set("tid", id);
          url = u.toString();
        } catch (e) {
          // keep raw url
        }
        window.location.href = url;
      }

      function clearAll() {
        localStorage.removeItem(KEY);
        document.getElementById("out").innerHTML = "ğŸ—‘ï¸ å·²æ¸…é™¤æœ¬åŸŸ localStorage tracker_id";
        refreshCurrentId();
      }

      refreshCurrentId();
    </script>
  </body>
</html>
