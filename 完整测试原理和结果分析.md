# WebView Pool è·¨è´¦å·æ•°æ®æ³„éœ²æµ‹è¯• - å®Œæ•´åŸç†å’Œç»“æœåˆ†æ

## ğŸ“‹ æµ‹è¯•åŸç†

### æ ¸å¿ƒé—®é¢˜
Reddit App ä½¿ç”¨äº† **WebView Pool**ï¼ˆWebView å¤ç”¨æ± ï¼‰æ¥æå‡æ€§èƒ½ï¼Œä½†é—®é¢˜æ˜¯ï¼š
- åŒä¸€ä¸ª WebView å®ä¾‹å¯èƒ½è¢«ä¸åŒè´¦å·å¤ç”¨
- å¦‚æœè´¦å·åˆ‡æ¢æ—¶æ²¡æœ‰æ¸…ç† WebView çš„å­˜å‚¨æ•°æ®
- é‚£ä¹ˆè´¦å· B å¯èƒ½çœ‹åˆ°è´¦å· A ç•™ä¸‹çš„æ•°æ®

### æµ‹è¯•æ–¹æ³•
æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæµ‹è¯•é¡µé¢ï¼Œé€šè¿‡ JavaScript å†™å…¥æµ‹è¯•æ•°æ®ï¼Œç„¶åéªŒè¯è¿™äº›æ•°æ®æ˜¯å¦ä¼šåœ¨è´¦å·åˆ‡æ¢åæ®‹ç•™ã€‚

---

## ğŸ”¬ æµ‹è¯•è®¾è®¡

### 1. æµ‹è¯•é¡µé¢åšäº†ä»€ä¹ˆï¼Ÿ

**æˆ‘ä»¬å†™çš„æµ‹è¯•é¡µé¢ï¼ˆindex.htmlï¼‰ä¼šï¼š**

#### å†™å…¥é˜¶æ®µï¼ˆè´¦å· Aï¼‰ï¼š
```javascript
// å½“ç”¨æˆ·ç‚¹å‡»"å†™å…¥æµ‹è¯•æ•°æ®"æŒ‰é’®æ—¶ï¼š
localStorage.setItem('test_account_A', 'account_A_data');
sessionStorage.setItem('test_account_A_session', 'account_A_data_session');
document.cookie = 'test_account_A_cookie=account_A_data_cookie; path=/; max-age=3600';
```

**å†™å…¥çš„å†…å®¹ï¼š**
- âœ… **localStorage**: `test_account_A = account_A_data`
  - è¿™æ˜¯æˆ‘ä»¬æµ‹è¯•é¡µé¢**è‡ªå·±è®¾ç½®çš„æµ‹è¯•æ•°æ®**
  - ä¸æ˜¯ Reddit çš„çœŸå®æ•°æ®
  - é”®åå’Œå€¼éƒ½æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„

- âœ… **sessionStorage**: `test_account_A_session = account_A_data_session`
  - åŒæ ·æ˜¯æˆ‘ä»¬**è‡ªå·±è®¾ç½®çš„æµ‹è¯•æ•°æ®**

- âœ… **Cookie**: `test_account_A_cookie = account_A_data_cookie`
  - åŒæ ·æ˜¯æˆ‘ä»¬**è‡ªå·±è®¾ç½®çš„æµ‹è¯•æ•°æ®**
  - ä¸æ˜¯ Reddit æœåŠ¡å™¨è®¾ç½®çš„ Cookie

#### è¯»å–é˜¶æ®µï¼ˆè´¦å· Bï¼‰ï¼š
```javascript
// å½“é¡µé¢åŠ è½½æ—¶ï¼Œè‡ªåŠ¨è¯»å–ï¼š
for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    lsData[key] = localStorage.getItem(key);
}
// åŒæ ·è¯»å– sessionStorage å’Œ Cookie
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

### 1. ä¸ºä»€ä¹ˆç”¨æµ‹è¯•æ•°æ®ï¼Œä¸ç”¨çœŸå®æ•°æ®ï¼Ÿ

**åŸå› ï¼š**
- âœ… **å¯æ§æ€§**ï¼šæˆ‘ä»¬çŸ¥é“å†™å…¥çš„æ˜¯ä»€ä¹ˆï¼Œä¾¿äºåˆ¤æ–­
- âœ… **å®‰å…¨æ€§**ï¼šä¸ä¼šæ³„éœ²çœŸå®ç”¨æˆ·æ•°æ®
- âœ… **å¯å¤ç°**ï¼šæ¯æ¬¡æµ‹è¯•ç»“æœä¸€è‡´
- âœ… **æ˜“è¯†åˆ«**ï¼š`test_account_A` è¿™ä¸ªé”®åæ˜æ˜¾æ˜¯æµ‹è¯•æ•°æ®

### 2. æµ‹è¯•æ•°æ®çš„æ„ä¹‰

è™½ç„¶æ•°æ®æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ï¼Œä½†**æµ‹è¯•çš„æ˜¯å­˜å‚¨æœºåˆ¶**ï¼š
- å¦‚æœè´¦å· B èƒ½çœ‹åˆ°è´¦å· A å†™å…¥çš„æµ‹è¯•æ•°æ®
- è¯´æ˜ **WebView çš„å­˜å‚¨æ²¡æœ‰è¢«æ¸…ç†/éš”ç¦»**
- é‚£ä¹ˆ**ä»»ä½•æ•°æ®**ï¼ˆåŒ…æ‹¬ Reddit çš„çœŸå®æ•°æ®ï¼‰éƒ½å¯èƒ½æ®‹ç•™

### 3. ç±»æ¯”è¯´æ˜

å°±åƒæµ‹è¯•ä¸€ä¸ª"æˆ¿é—´"æ˜¯å¦å®‰å…¨ï¼š
- æˆ‘ä»¬åœ¨æˆ¿é—´é‡Œæ”¾äº†ä¸€ä¸ª**æ ‡è®°ç‰©**ï¼ˆæµ‹è¯•æ•°æ®ï¼‰
- å¦‚æœæ ‡è®°ç‰©åœ¨è´¦å·åˆ‡æ¢åè¿˜åœ¨ï¼Œè¯´æ˜æˆ¿é—´æ²¡æœ‰è¢«æ¸…ç†
- é‚£ä¹ˆ**ä»»ä½•ä¸œè¥¿**ï¼ˆåŒ…æ‹¬çœŸå®æ•°æ®ï¼‰éƒ½å¯èƒ½ç•™åœ¨æˆ¿é—´é‡Œ

---

## ğŸ“Š ä½ çš„æµ‹è¯•ç»“æœåˆ†æ

### è´¦å· Aï¼ˆkorosensei0510ï¼‰- å†™å…¥é˜¶æ®µ

**æ—¶é—´**: 2026-01-09T05:54:34.416Z

**å†™å…¥çš„æ•°æ®**ï¼š
```json
{
  "localStorage": {
    "test_account_A": "account_A_data"
  },
  "sessionStorage": {
    "test_account_A_session": "account_A_data_session"
  },
  "Cookie": {
    "test_account_A_cookie": "account_A_data_cookie"
  }
}
```

**è¯´æ˜**ï¼š
- è¿™äº›éƒ½æ˜¯**æˆ‘ä»¬æµ‹è¯•é¡µé¢è‡ªå·±å†™å…¥çš„æµ‹è¯•æ•°æ®**
- ä¸æ˜¯ Reddit çš„çœŸå®æ•°æ®
- é”®å `test_account_A` æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„

---

### è´¦å· Bï¼ˆKaressiqiaoï¼‰- è¯»å–é˜¶æ®µ

**æ—¶é—´**: 2026-01-09T05:55:34.643Zï¼ˆ1åˆ†é’Ÿåï¼‰

**è¯»å–åˆ°çš„æ•°æ®**ï¼š
```json
{
  "localStorage": {
    "test_account_A": "account_A_data"  âš ï¸ æ®‹ç•™ï¼
  },
  "sessionStorage": {
    "ï¼ˆç©ºï¼‰"  âœ… æ­£å¸¸ï¼ˆä¼šè¯çº§ï¼Œå…³é—­åæ¸…ç©ºï¼‰
  },
  "Cookie": {
    "test_account_A_cookie": "account_A_data_cookie"  âš ï¸ æ®‹ç•™ï¼
  }
}
```

---

## ğŸš¨ å…³é”®å‘ç°

### 1. localStorage æ•°æ®æ®‹ç•™

**å‘ç°**ï¼š
- è´¦å· B èƒ½çœ‹åˆ°è´¦å· A å†™å…¥çš„ `test_account_A = account_A_data`
- **è¿™è¯´æ˜ localStorage æ²¡æœ‰è¢«æ¸…ç†æˆ–éš”ç¦»**

**æ„ä¹‰**ï¼š
- å¦‚æœ Reddit çš„ WebView é¡µé¢åœ¨ localStorage ä¸­å­˜å‚¨äº†ç”¨æˆ·æ•°æ®
- è´¦å· B å¯èƒ½èƒ½çœ‹åˆ°è´¦å· A çš„æ•°æ®

### 2. Cookie æ•°æ®æ®‹ç•™

**å‘ç°**ï¼š
- è´¦å· B èƒ½çœ‹åˆ°è´¦å· A å†™å…¥çš„ `test_account_A_cookie = account_A_data_cookie`
- **è¿™è¯´æ˜ Cookie æ²¡æœ‰è¢«æ¸…ç†æˆ–éš”ç¦»**

**æ„ä¹‰**ï¼š
- å¦‚æœ Reddit çš„ WebView é¡µé¢è®¾ç½®äº† Cookie
- è´¦å· B å¯èƒ½èƒ½çœ‹åˆ°è´¦å· A çš„ Cookie

### 3. sessionStorage æ­£å¸¸

**å‘ç°**ï¼š
- sessionStorage ä¸ºç©ºï¼ˆæ­£å¸¸ï¼‰
- å› ä¸º sessionStorage æ˜¯ä¼šè¯çº§çš„ï¼Œå…³é—­é¡µé¢åè‡ªåŠ¨æ¸…ç©º

---

## ğŸ” æŠ€æœ¯åŸç†

### WebView å­˜å‚¨æœºåˆ¶

åœ¨ Android WebView ä¸­ï¼š

1. **localStorage**ï¼š
   - å­˜å‚¨åœ¨ï¼š`/data/data/åŒ…å/app_webview/Default/Local Storage/`
   - æŒ‰ originï¼ˆåŸŸåï¼‰éš”ç¦»
   - **æŒä¹…åŒ–å­˜å‚¨**ï¼Œä¸ä¼šè‡ªåŠ¨æ¸…ç†

2. **sessionStorage**ï¼š
   - å­˜å‚¨åœ¨å†…å­˜ä¸­
   - **ä¼šè¯çº§**ï¼Œå…³é—­é¡µé¢åæ¸…ç©º
   - æ‰€ä»¥è´¦å· B çœ‹ä¸åˆ°æ˜¯æ­£å¸¸çš„

3. **Cookie**ï¼š
   - å­˜å‚¨åœ¨ï¼š`/data/data/åŒ…å/app_webview/Default/Cookies`
   - æŒ‰ origin éš”ç¦»
   - **æŒä¹…åŒ–å­˜å‚¨**ï¼Œä¸ä¼šè‡ªåŠ¨æ¸…ç†

### WebView Pool çš„é—®é¢˜

**æ­£å¸¸æƒ…å†µ**ï¼š
- æ¯ä¸ªè´¦å·åº”è¯¥æœ‰ç‹¬ç«‹çš„ WebView æ•°æ®ç›®å½•
- æˆ–è€…è´¦å·åˆ‡æ¢æ—¶æ¸…ç†æ•°æ®

**å®é™…æƒ…å†µï¼ˆä»æµ‹è¯•çœ‹ï¼‰**ï¼š
- åŒä¸€ä¸ª WebView å®ä¾‹è¢«ä¸¤ä¸ªè´¦å·å¤ç”¨
- æ•°æ®æ²¡æœ‰è¢«æ¸…ç†
- å¯¼è‡´è´¦å· B èƒ½çœ‹åˆ°è´¦å· A çš„æ•°æ®

---

## ğŸ“ˆ é£é™©è¯„ä¼°

### å®é™…å½±å“

è™½ç„¶æˆ‘ä»¬æµ‹è¯•çš„æ˜¯**æµ‹è¯•æ•°æ®**ï¼Œä½†é—®é¢˜åœ¨äºï¼š

1. **å¦‚æœ Reddit çš„ WebView é¡µé¢å­˜å‚¨äº†çœŸå®æ•°æ®**ï¼š
   - ç”¨æˆ· IDã€tokenã€ä¸ªäººä¿¡æ¯ç­‰
   - è¿™äº›æ•°æ®ä¹Ÿå¯èƒ½åœ¨è´¦å·åˆ‡æ¢åæ®‹ç•™

2. **å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶ WebView åŠ è½½çš„å†…å®¹**ï¼š
   - å¯ä»¥åœ¨ localStorage ä¸­å†™å…¥æ¶æ„æ•°æ®
   - è¿™äº›æ•°æ®å¯èƒ½è¢«å…¶ä»–è´¦å·çœ‹åˆ°

3. **å¦‚æœ WebView åŠ è½½äº†ç¬¬ä¸‰æ–¹å†…å®¹**ï¼š
   - ç¬¬ä¸‰æ–¹ç½‘ç«™è®¾ç½®çš„ Cookie å¯èƒ½æ®‹ç•™
   - å¯èƒ½å¯¼è‡´è·¨è´¦å·è·Ÿè¸ª

---

## âœ… ç»“è®º

### æµ‹è¯•è¯å®

1. âœ… **WebView Pool ç¡®å®å­˜åœ¨**
2. âœ… **è´¦å·åˆ‡æ¢åï¼ŒlocalStorage å’Œ Cookie æ²¡æœ‰æ¸…ç†**
3. âœ… **å­˜åœ¨è·¨è´¦å·æ•°æ®æ®‹ç•™é£é™©**

### è™½ç„¶æµ‹è¯•æ•°æ®æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„

ä½†**æµ‹è¯•çš„æ˜¯å­˜å‚¨æœºåˆ¶**ï¼š
- å¦‚æœæµ‹è¯•æ•°æ®èƒ½æ®‹ç•™ï¼ŒçœŸå®æ•°æ®ä¹Ÿå¯èƒ½æ®‹ç•™
- è¿™æ˜¯ä¸€ä¸ª**çœŸå®çš„å®‰å…¨é—®é¢˜**

### ä¿®å¤å»ºè®®

1. **è´¦å·åˆ‡æ¢æ—¶æ¸…ç† WebView å­˜å‚¨**ï¼š
   ```java
   // åœ¨è´¦å·åˆ‡æ¢æ—¶è°ƒç”¨
   webView.clearCache(true);
   webView.clearHistory();
   // æ¸…ç† localStorageï¼ˆéœ€è¦é€šè¿‡ JavaScriptï¼‰
   webView.evaluateJavascript("localStorage.clear();", null);
   // æ¸…ç† Cookie
   CookieManager.getInstance().removeAllCookies(null);
   ```

2. **ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®ç›®å½•**ï¼š
   ```java
   // ä¸ºæ¯ä¸ªè´¦å·è®¾ç½®ä¸åŒçš„æ•°æ®ç›®å½•
   WebView.setDataDirectorySuffix("account_" + userId);
   ```

3. **åœ¨ releaseWebView æ—¶æ¸…ç†**ï¼š
   - åœ¨ `releaseWebView()` æ–¹æ³•ä¸­æ·»åŠ æ¸…ç†é€»è¾‘
   - ç¡®ä¿ WebView æ”¾å› Pool å‰æ¸…ç†æ‰€æœ‰æ•°æ®

---

## ğŸ“ æ€»ç»“

**æµ‹è¯•æ–¹æ³•**ï¼š
- ä½¿ç”¨æµ‹è¯•é¡µé¢å†™å…¥æµ‹è¯•æ•°æ®ï¼ˆlocalStorageã€Cookieï¼‰
- éªŒè¯è´¦å·åˆ‡æ¢åæ•°æ®æ˜¯å¦æ®‹ç•™

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… è¯å® localStorage å’Œ Cookie å­˜åœ¨è·¨è´¦å·æ®‹ç•™
- âœ… è¿™æ˜¯ä¸€ä¸ªçœŸå®çš„å®‰å…¨é—®é¢˜

**è™½ç„¶æ•°æ®æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ï¼Œä½†é—®é¢˜æœ¬èº«æ˜¯çœŸå®çš„**ï¼š
- å¦‚æœæµ‹è¯•æ•°æ®èƒ½æ®‹ç•™ï¼Œä»»ä½•æ•°æ®éƒ½å¯èƒ½æ®‹ç•™
- éœ€è¦ä¿®å¤ WebView Pool çš„æ¸…ç†æœºåˆ¶
