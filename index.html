<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebView Pool é£é™©æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 10px;
        }
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        .data-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            word-break: break-all;
        }
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4caf50;
        }
        .status.warning {
            background: rgba(255, 152, 0, 0.3);
            border: 2px solid #ff9800;
        }
        .status.danger {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #f44336;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 16px;
            margin-bottom: 10px;
        }
        input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .info {
            background: rgba(33, 150, 243, 0.3);
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” WebView Pool é£é™©æµ‹è¯•</h1>
        
        <div class="info">
            <strong>æµ‹è¯•è¯´æ˜ï¼š</strong><br>
            1. åœ¨è´¦å· A ä¸‹ï¼Œç‚¹å‡»"å†™å…¥æµ‹è¯•æ•°æ®"<br>
            2. å…³é—­é¡µé¢ï¼Œåˆ‡æ¢åˆ°è´¦å· B<br>
            3. å†æ¬¡æ‰“å¼€æ­¤é¡µé¢ï¼Œæ£€æŸ¥æ˜¯å¦è¿˜èƒ½çœ‹åˆ°è´¦å· A çš„æ•°æ®
        </div>

        <div id="status" class="status"></div>

        <div class="section">
            <h2>ğŸ“ æ“ä½œ</h2>
            <input type="text" id="testKey" placeholder="è¾“å…¥æµ‹è¯•é”®åï¼ˆå¦‚ï¼štest_account_Aï¼‰" value="test_account_A">
            <input type="text" id="testValue" placeholder="è¾“å…¥æµ‹è¯•å€¼ï¼ˆå¦‚ï¼šaccount_A_dataï¼‰" value="account_A_data">
            <button onclick="writeTestData()">âœ… å†™å…¥æµ‹è¯•æ•°æ®</button>
            <button onclick="readAllData()">ğŸ“– è¯»å–æ‰€æœ‰æ•°æ®</button>
            <button onclick="detectRealBusinessData()" style="background: rgba(244, 67, 54, 0.3); border-color: #f44336;">ğŸ” æ£€æµ‹çœŸå®ä¸šåŠ¡æ•°æ®</button>
            <button onclick="checkWindowName()" style="background: rgba(255, 152, 0, 0.3); border-color: #ff9800;">ğŸ” æ£€æŸ¥ window.name</button>
            <button onclick="copyAllData()" style="background: rgba(76, 175, 80, 0.3); border-color: #4caf50;">ğŸ“‹ å¤åˆ¶æ‰€æœ‰æ•°æ®ï¼ˆJSONï¼‰</button>
            <button onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
        </div>

        <div class="section" id="realDataSection" style="display: none;">
            <h2>ğŸ” çœŸå®ä¸šåŠ¡æ•°æ®æ£€æµ‹ç»“æœ</h2>
            <div id="realDataDisplay" class="data-display"></div>
            <button onclick="copyRealData()" style="background: rgba(244, 67, 54, 0.3); border-color: #f44336; margin-top: 10px;">ğŸ“‹ å¤åˆ¶æ£€æµ‹æŠ¥å‘Š</button>
        </div>

        <div class="section">
            <h2>ğŸ’¾ localStorage æ•°æ®</h2>
            <div id="localStorageData" class="data-display">ç‚¹å‡»"è¯»å–æ‰€æœ‰æ•°æ®"æŸ¥çœ‹</div>
        </div>

        <div class="section">
            <h2>ğŸ“¦ sessionStorage æ•°æ®</h2>
            <div id="sessionStorageData" class="data-display">ç‚¹å‡»"è¯»å–æ‰€æœ‰æ•°æ®"æŸ¥çœ‹</div>
        </div>

        <div class="section">
            <h2>ğŸª Cookie æ•°æ®</h2>
            <div id="cookieData" class="data-display">ç‚¹å‡»"è¯»å–æ‰€æœ‰æ•°æ®"æŸ¥çœ‹</div>
        </div>

        <div class="section">
            <h2>â„¹ï¸ é¡µé¢ä¿¡æ¯</h2>
            <div id="pageInfo" class="data-display"></div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å†™å…¥ä¸€æ¬¡æµ‹è¯•æ•°æ®ï¼ˆä»…é¦–æ¬¡ï¼‰ï¼Œå¹¶æ˜¾ç¤ºä¿¡æ¯
        window.onload = function() {
            autoInitTestData();
            readAllData();
            updatePageInfo();
        };

        // é¦–æ¬¡è®¿é—®æ—¶è‡ªåŠ¨å†™å…¥æµ‹è¯•æ•°æ®ï¼Œåç»­è´¦å·/ä¼šè¯åªè¯»å–ä¸è¦†ç›–
        function autoInitTestData() {
            // æµ‹è¯• window.name æ˜¯å¦ä¼šåœ¨è´¦å·åˆ‡æ¢åæ®‹ç•™
            if (!window.name || window.name.trim() === '' || window.name === 'test_window_name_A') {
                // é¦–æ¬¡è®¿é—®ï¼Œè®¾ç½®æµ‹è¯•ç”¨çš„ window.name
                window.name = 'test_window_name_A_' + Date.now();
                showStatus('å·²è®¾ç½®æµ‹è¯• window.name', 'success');
            } else if (window.name.startsWith('test_window_name_A')) {
                // æ£€æµ‹åˆ°ä¹‹å‰è®¾ç½®çš„ window.nameï¼Œè¯´æ˜è·¨è´¦å·æ®‹ç•™äº†
                showStatus('âš ï¸ æ£€æµ‹åˆ° window.name æ®‹ç•™ï¼', 'warning');
            }
            
            // å¦‚æœå·²ç»å­˜åœ¨æˆ‘ä»¬çš„æµ‹è¯•é”®ï¼Œè¯´æ˜ä¹‹å‰æŸä¸ªè´¦å·/ä¼šè¯å†™å…¥è¿‡ï¼Œç›´æ¥è¯»å–å³å¯
            if (localStorage.getItem('test_account_A')) {
                showStatus('æ£€æµ‹åˆ°å·²æœ‰æµ‹è¯•æ•°æ®ï¼ˆæœªè¦†ç›–ï¼‰', 'warning');
                return;
            }

            // ç”Ÿæˆä¸€æ¬¡æ€§çš„æ ‡è®°å€¼ï¼Œç”¨äºåŒºåˆ†é¦–ä¸ªå†™å…¥è€…
            const value = 'auto_' + Date.now();

            try {
                // å†™å…¥ localStorageï¼ˆæŒä¹…ï¼‰
                localStorage.setItem('test_account_A', value);

                // å†™å…¥ sessionStorageï¼ˆä¼šè¯ï¼‰
                sessionStorage.setItem('test_account_A_session', value + '_session');

                // å†™å…¥ Cookieï¼ˆæŒä¹…ï¼‰
                document.cookie = 'test_account_A_cookie=' + value + '_cookie; path=/; max-age=3600';

                showStatus('é¦–æ¬¡è®¿é—®ï¼šå·²è‡ªåŠ¨å†™å…¥æµ‹è¯•æ•°æ®', 'success');
            } catch (e) {
                showStatus('âŒ è‡ªåŠ¨å†™å…¥å¤±è´¥: ' + e.message, 'danger');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        // æ‰‹åŠ¨å†™å…¥æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼Œç”¨äºè¦†ç›–å½“å‰ä¼šè¯çš„å€¼ï¼‰
        function writeTestData() {
            const key = document.getElementById('testKey').value || 'test_account_A';
            const value = document.getElementById('testValue').value || 'account_A_data_' + Date.now();
            
            try {
                // å†™å…¥ localStorage
                localStorage.setItem(key, value);
                
                // å†™å…¥ sessionStorage
                sessionStorage.setItem(key + '_session', value + '_session');
                
                // å†™å…¥ Cookie
                document.cookie = key + '_cookie=' + value + '_cookie; path=/; max-age=3600';
                
                showStatus('âœ… æ•°æ®å†™å…¥æˆåŠŸï¼é”®: ' + key, 'success');
                readAllData();
            } catch (e) {
                showStatus('âŒ å†™å…¥å¤±è´¥: ' + e.message, 'danger');
            }
        }

        function readAllData() {
            // è¯»å– localStorage
            let lsData = {};
            try {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    lsData[key] = localStorage.getItem(key);
                }
            } catch (e) {
                lsData = {error: e.message};
            }
            document.getElementById('localStorageData').textContent = 
                Object.keys(lsData).length > 0 
                    ? JSON.stringify(lsData, null, 2)
                    : 'ï¼ˆç©ºï¼‰';

            // è¯»å– sessionStorage
            let ssData = {};
            try {
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    ssData[key] = sessionStorage.getItem(key);
                }
            } catch (e) {
                ssData = {error: e.message};
            }
            document.getElementById('sessionStorageData').textContent = 
                Object.keys(ssData).length > 0 
                    ? JSON.stringify(ssData, null, 2)
                    : 'ï¼ˆç©ºï¼‰';

            // è¯»å– Cookie
            const cookies = document.cookie || 'ï¼ˆç©ºï¼‰';
            document.getElementById('cookieData').textContent = cookies;

            // æ£€æŸ¥æ˜¯å¦æœ‰æ®‹ç•™æ•°æ®
            if (Object.keys(lsData).length > 0 || Object.keys(ssData).length > 0 || cookies !== 'ï¼ˆç©ºï¼‰') {
                showStatus('âš ï¸ æ£€æµ‹åˆ°æ•°æ®ï¼å¯èƒ½æ˜¯è·¨è´¦å·æ®‹ç•™', 'warning');
            } else {
                showStatus('âœ… æœªæ£€æµ‹åˆ°æ•°æ®', 'success');
            }
        }

        function copyAllData() {
            try {
                // è¯»å–æ‰€æœ‰æ•°æ®
                let lsData = {};
                try {
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        lsData[key] = localStorage.getItem(key);
                    }
                } catch (e) {
                    lsData = {error: e.message};
                }

                let ssData = {};
                try {
                    for (let i = 0; i < sessionStorage.length; i++) {
                        const key = sessionStorage.key(i);
                        ssData[key] = sessionStorage.getItem(key);
                    }
                } catch (e) {
                    ssData = {error: e.message};
                }

                // è§£æ Cookie
                const cookies = document.cookie || '';
                let cookieObj = {};
                if (cookies.trim() !== '') {
                    cookies.split(';').forEach(function(c) {
                        const parts = c.trim().split('=');
                        if (parts.length >= 2) {
                            cookieObj[parts[0]] = parts.slice(1).join('=');
                        }
                    });
                }

                // é¡µé¢ä¿¡æ¯
                const pageInfo = {
                    'URL': window.location.href,
                    'Origin': window.location.origin,
                    'User Agent': navigator.userAgent,
                    'æ—¶é—´æˆ³': new Date().toISOString()
                };

                // ç»„åˆæ‰€æœ‰æ•°æ®
                const allData = {
                    'æµ‹è¯•æ—¶é—´': new Date().toISOString(),
                    'é¡µé¢ä¿¡æ¯': pageInfo,
                    'localStorage': Object.keys(lsData).length > 0 ? lsData : 'ï¼ˆç©ºï¼‰',
                    'sessionStorage': Object.keys(ssData).length > 0 ? ssData : 'ï¼ˆç©ºï¼‰',
                    'Cookie': Object.keys(cookieObj).length > 0 ? cookieObj : 'ï¼ˆç©ºï¼‰',
                    'CookieåŸå§‹å­—ç¬¦ä¸²': cookies || 'ï¼ˆç©ºï¼‰'
                };

                // æ ¼å¼åŒ–ä¸º JSON
                const jsonString = JSON.stringify(allData, null, 2);

                // å¤åˆ¶åˆ°å‰ªè´´æ¿
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(jsonString).then(function() {
                        showStatus('âœ… æ‰€æœ‰æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                    }).catch(function(err) {
                        // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                        fallbackCopy(jsonString);
                    });
                } else {
                    // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                    fallbackCopy(jsonString);
                }
            } catch (e) {
                showStatus('âŒ å¤åˆ¶å¤±è´¥: ' + e.message, 'danger');
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showStatus('âœ… æ‰€æœ‰æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            } catch (err) {
                showStatus('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'danger');
                // å¦‚æœå¤åˆ¶å¤±è´¥ï¼Œè‡³å°‘æ˜¾ç¤ºæ•°æ®è®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
                alert('å¤åˆ¶å¤±è´¥ï¼Œæ•°æ®å¦‚ä¸‹ï¼š\n\n' + text);
            }
            document.body.removeChild(textArea);
        }

        function detectRealBusinessData() {
            try {
                const report = {
                    timestamp: new Date().toISOString(),
                    origin: window.location.origin,
                    url: window.location.href,
                    localStorage: {},
                    sessionStorage: {},
                    cookies: {},
                    suspiciousKeys: [],
                    redditRelated: {},
                    potentialRisks: []
                };

                // å¯ç–‘å…³é”®è¯æ¨¡å¼
                const suspiciousPatterns = [
                    'auth', 'token', 'session', 'user', 'id', 'login', 'credential',
                    'reddit', 'devvit', 'devplatform', 'bridge', 'api', 'key',
                    'secret', 'password', 'pwd', 'access', 'refresh', 'jwt'
                ];

                // æ£€æµ‹ localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    report.localStorage[key] = value;
                    
                    // æ£€æŸ¥æ˜¯å¦åŒ…å«å¯ç–‘å…³é”®è¯
                    const keyLower = key.toLowerCase();
                    const valueLower = (value || '').toLowerCase();
                    
                    const isSuspicious = suspiciousPatterns.some(pattern => 
                        keyLower.includes(pattern) || valueLower.includes(pattern)
                    );
                    
                    if (isSuspicious) {
                        report.suspiciousKeys.push(key);
                        report.redditRelated[key] = value;
                        
                        // è¯„ä¼°é£é™©ç­‰çº§
                        if (keyLower.includes('token') || keyLower.includes('auth') || 
                            keyLower.includes('session')) {
                            report.potentialRisks.push({
                                type: 'é«˜é£é™©',
                                key: key,
                                reason: 'åŒ…å«è®¤è¯/ä¼šè¯ç›¸å…³å…³é”®è¯',
                                value: value.substring(0, 50) + (value.length > 50 ? '...' : '')
                            });
                        } else if (keyLower.includes('user') || keyLower.includes('id')) {
                            report.potentialRisks.push({
                                type: 'ä¸­é£é™©',
                                key: key,
                                reason: 'åŒ…å«ç”¨æˆ·æ ‡è¯†ç›¸å…³å…³é”®è¯',
                                value: value.substring(0, 50) + (value.length > 50 ? '...' : '')
                            });
                        }
                    }
                }

                // æ£€æµ‹ sessionStorage
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    const value = sessionStorage.getItem(key);
                    report.sessionStorage[key] = value;
                    
                    const keyLower = key.toLowerCase();
                    const valueLower = (value || '').toLowerCase();
                    
                    if (suspiciousPatterns.some(pattern => 
                        keyLower.includes(pattern) || valueLower.includes(pattern)
                    )) {
                        report.suspiciousKeys.push('sessionStorage:' + key);
                        report.redditRelated['sessionStorage:' + key] = value;
                    }
                }

                // è§£æ Cookie
                const cookies = document.cookie || '';
                if (cookies.trim() !== '') {
                    cookies.split(';').forEach(function(c) {
                        const parts = c.trim().split('=');
                        if (parts.length >= 2) {
                            const key = parts[0];
                            const value = parts.slice(1).join('=');
                            report.cookies[key] = value;
                            
                            const keyLower = key.toLowerCase();
                            if (suspiciousPatterns.some(pattern => keyLower.includes(pattern))) {
                                report.suspiciousKeys.push('cookie:' + key);
                                report.redditRelated['cookie:' + key] = value;
                            }
                        }
                    });
                }

                // æ£€æŸ¥ window.nameï¼ˆReddit DevPlatform ä½¿ç”¨ bridgeContextï¼‰
                if (window.name && window.name.trim() !== '') {
                    report.windowName = window.name;
                    
                    // å°è¯•è§£æä¸º JSONï¼ˆReddit çš„ bridgeContext æ˜¯ JSONï¼‰
                    let bridgeContext = null;
                    try {
                        bridgeContext = JSON.parse(window.name);
                        report.bridgeContext = bridgeContext;
                        
                        // æ£€æŸ¥ bridgeContext ä¸­çš„æ•æ„Ÿå­—æ®µ
                        const sensitiveFields = ['webbitToken', 'signedRequestContext', 'postData', 'webViewContext', 'webViewClientData'];
                        sensitiveFields.forEach(field => {
                            if (bridgeContext[field]) {
                                report.potentialRisks.push({
                                    type: 'é«˜é£é™©',
                                    key: 'window.name.bridgeContext.' + field,
                                    reason: 'bridgeContext åŒ…å« ' + field + 'ï¼Œå¯èƒ½åŒ…å«ç”¨æˆ·/ä¼šè¯ä¿¡æ¯',
                                    value: typeof bridgeContext[field] === 'string' 
                                        ? bridgeContext[field].substring(0, 100) + (bridgeContext[field].length > 100 ? '...' : '')
                                        : JSON.stringify(bridgeContext[field]).substring(0, 100)
                                });
                            }
                        });
                    } catch (e) {
                        // ä¸æ˜¯ JSONï¼Œå¯èƒ½æ˜¯æ™®é€šå­—ç¬¦ä¸²
                        if (window.name.length > 0 && !window.name.includes('test_account')) {
                            report.potentialRisks.push({
                                type: 'ä¸­é£é™©',
                                key: 'window.name',
                                reason: 'window.name åŒ…å«æ•°æ®ï¼ˆé JSONï¼‰',
                                value: window.name.substring(0, 100) + (window.name.length > 100 ? '...' : '')
                            });
                        }
                    }
                }

                // æ£€æµ‹ IndexedDBï¼ˆReddit å¯èƒ½ä½¿ç”¨ï¼‰
                report.indexedDB = {};
                if ('indexedDB' in window) {
                    try {
                        // å°è¯•åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“
                        if (indexedDB.databases) {
                            indexedDB.databases().then(databases => {
                                report.indexedDB.databases = databases.map(db => ({
                                    name: db.name,
                                    version: db.version
                                }));
                                
                                // æ£€æŸ¥æ¯ä¸ªæ•°æ®åº“
                                databases.forEach(db => {
                                    const request = indexedDB.open(db.name);
                                    request.onsuccess = function(event) {
                                        const db_obj = event.target.result;
                                        if (db_obj.objectStoreNames.length > 0) {
                                            report.indexedDB[db.name] = {
                                                objectStores: Array.from(db_obj.objectStoreNames),
                                                note: 'å‘ç°å¯¹è±¡å­˜å‚¨ï¼Œå¯èƒ½åŒ…å«æ•°æ®'
                                            };
                                        }
                                    };
                                });
                            }).catch(e => {
                                report.indexedDB.error = 'æ— æ³•è®¿é—®æ•°æ®åº“åˆ—è¡¨: ' + e.message;
                            });
                        } else {
                            report.indexedDB.note = 'æµè§ˆå™¨ä¸æ”¯æŒ indexedDB.databases()ï¼Œæ— æ³•è‡ªåŠ¨æ£€æµ‹';
                        }
                    } catch (e) {
                        report.indexedDB.error = 'æ£€æµ‹ IndexedDB æ—¶å‡ºé”™: ' + e.message;
                    }
                } else {
                    report.indexedDB.note = 'æµè§ˆå™¨ä¸æ”¯æŒ IndexedDB';
                }

                // æ˜¾ç¤ºç»“æœ
                let displayText = '=== çœŸå®ä¸šåŠ¡æ•°æ®æ£€æµ‹æŠ¥å‘Š ===\n\n';
                displayText += `æ£€æµ‹æ—¶é—´: ${report.timestamp}\n`;
                displayText += `Origin: ${report.origin}\n`;
                displayText += `URL: ${report.url}\n\n`;

                if (report.potentialRisks.length > 0) {
                    displayText += `âš ï¸ å‘ç° ${report.potentialRisks.length} ä¸ªæ½œåœ¨é£é™©é¡¹:\n\n`;
                    report.potentialRisks.forEach((risk, idx) => {
                        displayText += `${idx + 1}. [${risk.type}] ${risk.key}\n`;
                        displayText += `   åŸå› : ${risk.reason}\n`;
                        displayText += `   å€¼: ${risk.value}\n\n`;
                    });
                } else {
                    displayText += 'âœ… æœªå‘ç°æ˜æ˜¾çš„æ•æ„Ÿæ•°æ®\n\n';
                }

                displayText += `=== å¯ç–‘é”®åˆ—è¡¨ (${report.suspiciousKeys.length} ä¸ª) ===\n`;
                if (report.suspiciousKeys.length > 0) {
                    report.suspiciousKeys.forEach(key => {
                        displayText += `- ${key}\n`;
                    });
                } else {
                    displayText += 'æ— \n';
                }

                displayText += `\n=== Reddit ç›¸å…³æ•°æ® (${Object.keys(report.redditRelated).length} ä¸ª) ===\n`;
                if (Object.keys(report.redditRelated).length > 0) {
                    displayText += JSON.stringify(report.redditRelated, null, 2);
                } else {
                    displayText += 'æ— \n';
                }

                if (report.windowName) {
                    displayText += `\n=== window.name (bridgeContext) ===\n`;
                    displayText += `å†…å®¹: ${report.windowName.substring(0, 200)}${report.windowName.length > 200 ? '...' : ''}\n`;
                    if (report.bridgeContext) {
                        displayText += `\nè§£æåçš„ bridgeContext:\n`;
                        displayText += JSON.stringify(report.bridgeContext, null, 2) + '\n';
                        displayText += `\nâš ï¸ bridgeContext å¯èƒ½åŒ…å«:\n`;
                        displayText += `- webbitToken: ${report.bridgeContext.webbitToken ? 'æ˜¯' : 'å¦'}\n`;
                        displayText += `- signedRequestContext: ${report.bridgeContext.signedRequestContext ? 'æ˜¯' : 'å¦'}\n`;
                        displayText += `- postData: ${report.bridgeContext.postData ? 'æ˜¯' : 'å¦'}\n`;
                        displayText += `- webViewContext: ${report.bridgeContext.webViewContext ? 'æ˜¯' : 'å¦'}\n`;
                        displayText += `- webViewClientData: ${report.bridgeContext.webViewClientData ? 'æ˜¯' : 'å¦'}\n`;
                    }
                }
                
                displayText += `\n=== å®Œæ•´æ•°æ® ===\n`;
                displayText += `localStorage: ${Object.keys(report.localStorage).length} é¡¹\n`;
                displayText += `sessionStorage: ${Object.keys(report.sessionStorage).length} é¡¹\n`;
                displayText += `Cookies: ${Object.keys(report.cookies).length} é¡¹\n`;
                
                if (report.indexedDB) {
                    displayText += `\n=== IndexedDB ===\n`;
                    if (report.indexedDB.databases && report.indexedDB.databases.length > 0) {
                        displayText += `å‘ç° ${report.indexedDB.databases.length} ä¸ªæ•°æ®åº“:\n`;
                        report.indexedDB.databases.forEach(db => {
                            displayText += `- ${db.name} (ç‰ˆæœ¬: ${db.version})\n`;
                        });
                    } else if (report.indexedDB.note) {
                        displayText += report.indexedDB.note + '\n';
                    } else {
                        displayText += 'æœªå‘ç° IndexedDB æ•°æ®åº“\n';
                    }
                }
                
                // é‡è¦æç¤º
                if (Object.keys(report.localStorage).length === 0 && 
                    Object.keys(report.sessionStorage).length === 0 && 
                    Object.keys(report.cookies).length === 0) {
                    displayText += `\nâš ï¸ é‡è¦å‘ç°ï¼šå½“å‰ origin ä¸‹æœªå‘ç°ä»»ä½•å­˜å‚¨æ•°æ®\n`;
                    displayText += `è¿™å¯èƒ½è¯´æ˜ï¼š\n`;
                    displayText += `1. Reddit æ²¡æœ‰åœ¨è¿™ä¸ª origin ä¸‹å­˜å‚¨æ•æ„Ÿæ•°æ®\n`;
                    displayText += `2. æ•°æ®å¯èƒ½å­˜å‚¨åœ¨å…¶ä»– originï¼ˆå¦‚ reddit.comã€devvit.reddit.comï¼‰\n`;
                    displayText += `3. æ•°æ®å¯èƒ½ä½¿ç”¨å…¶ä»–å­˜å‚¨æ–¹å¼ï¼ˆIndexedDBã€Native å±‚ç­‰ï¼‰\n`;
                    displayText += `4. æ•°æ®å¯èƒ½é€šè¿‡ bridge ä¼ é€’ä½†ä¸æŒä¹…åŒ–\n`;
                }

                document.getElementById('realDataDisplay').textContent = displayText;
                document.getElementById('realDataSection').style.display = 'block';
                
                // ä¿å­˜æŠ¥å‘Šåˆ°å…¨å±€å˜é‡ï¼Œæ–¹ä¾¿å¤åˆ¶
                window.lastRealDataReport = report;

                if (report.potentialRisks.length > 0) {
                    showStatus(`âš ï¸ å‘ç° ${report.potentialRisks.length} ä¸ªæ½œåœ¨é£é™©ï¼`, 'warning');
                } else if (report.suspiciousKeys.length > 0) {
                    showStatus(`â„¹ï¸ å‘ç° ${report.suspiciousKeys.length} ä¸ªå¯ç–‘é”®`, 'success');
                } else {
                    showStatus('âœ… æœªå‘ç°æ˜æ˜¾çš„ä¸šåŠ¡æ•°æ®', 'success');
                }

            } catch (e) {
                showStatus('âŒ æ£€æµ‹å¤±è´¥: ' + e.message, 'danger');
            }
        }

        function checkWindowName() {
            const windowNameSection = document.getElementById('realDataSection');
            const windowNameDisplay = document.getElementById('realDataDisplay');
            
            let displayText = '=== window.name æ£€æµ‹ ===\n\n';
            
            if (window.name && window.name.trim() !== '') {
                displayText += `âœ… window.name æœ‰å€¼\n`;
                displayText += `é•¿åº¦: ${window.name.length} å­—ç¬¦\n\n`;
                displayText += `åŸå§‹å†…å®¹ï¼ˆå‰500å­—ç¬¦ï¼‰:\n${window.name.substring(0, 500)}${window.name.length > 500 ? '...' : ''}\n\n`;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯æˆ‘ä»¬çš„æµ‹è¯•æ•°æ®
                if (window.name.startsWith('test_window_name_A')) {
                    displayText += `âš ï¸ è¿™æ˜¯æµ‹è¯•æ•°æ®ï¼ˆtest_window_name_Aï¼‰\n`;
                    displayText += `å¦‚æœè¿™æ˜¯è´¦å· B çš„æ£€æµ‹ï¼Œè¯´æ˜ window.name è·¨è´¦å·æ®‹ç•™äº†ï¼\n\n`;
                }
                
                // å°è¯•è§£æä¸º JSON
                try {
                    const bridgeContext = JSON.parse(window.name);
                    displayText += `âœ… æˆåŠŸè§£æä¸º JSONï¼ˆå¯èƒ½æ˜¯ Reddit çš„ bridgeContextï¼‰\n\n`;
                    displayText += `è§£æåçš„ bridgeContext:\n${JSON.stringify(bridgeContext, null, 2)}\n\n`;
                    
                    displayText += `âš ï¸ æ•æ„Ÿå­—æ®µæ£€æŸ¥:\n`;
                    const sensitiveFields = ['webbitToken', 'signedRequestContext', 'postData', 'webViewContext', 'webViewClientData'];
                    sensitiveFields.forEach(field => {
                        if (bridgeContext[field]) {
                            displayText += `- ${field}: âœ… å­˜åœ¨\n`;
                            if (typeof bridgeContext[field] === 'string') {
                                displayText += `  å€¼: ${bridgeContext[field].substring(0, 100)}${bridgeContext[field].length > 100 ? '...' : ''}\n`;
                            } else {
                                displayText += `  å€¼: ${JSON.stringify(bridgeContext[field]).substring(0, 100)}...\n`;
                            }
                        } else {
                            displayText += `- ${field}: âŒ ä¸å­˜åœ¨\n`;
                        }
                    });
                } catch (e) {
                    displayText += `â„¹ï¸ ä¸æ˜¯æœ‰æ•ˆçš„ JSON: ${e.message}\n`;
                    displayText += `å¯èƒ½æ˜¯æ™®é€šå­—ç¬¦ä¸²æˆ–æµ‹è¯•æ•°æ®\n`;
                }
            } else {
                displayText += `âŒ window.name ä¸ºç©ºæˆ–æœªè®¾ç½®\n\n`;
                displayText += `è¯´æ˜ï¼š\n`;
                displayText += `- å¦‚æœè¿™æ˜¯ Reddit çš„ DevPlatform é¡µé¢ï¼Œåº”è¯¥ä¼šæœ‰ bridgeContext\n`;
                displayText += `- å¦‚æœè¿™æ˜¯æ™®é€šæµ‹è¯•é¡µé¢ï¼Œwindow.name ä¸ºç©ºæ˜¯æ­£å¸¸çš„\n`;
                displayText += `- æˆ‘ä»¬çš„æµ‹è¯•é¡µé¢ä¼šåœ¨é¦–æ¬¡è®¿é—®æ—¶è‡ªåŠ¨è®¾ç½®æµ‹è¯•ç”¨çš„ window.name\n`;
                displayText += `- å¦‚æœè´¦å· B èƒ½çœ‹åˆ°è´¦å· A è®¾ç½®çš„æµ‹è¯• window.nameï¼Œè¯´æ˜å­˜åœ¨è·¨è´¦å·æ®‹ç•™é£é™©\n\n`;
                displayText += `æµ‹è¯•æ–¹æ³•ï¼š\n`;
                displayText += `1. è´¦å· A æ‰“å¼€æ­¤é¡µé¢ï¼Œä¼šè‡ªåŠ¨è®¾ç½® test_window_name_A\n`;
                displayText += `2. åˆ‡æ¢åˆ°è´¦å· Bï¼Œå†æ¬¡æ‰“å¼€æ­¤é¡µé¢\n`;
                displayText += `3. å¦‚æœè´¦å· B èƒ½çœ‹åˆ° test_window_name_Aï¼Œè¯´æ˜ window.name è·¨è´¦å·æ®‹ç•™äº†\n`;
            }
            
            windowNameDisplay.textContent = displayText;
            windowNameSection.style.display = 'block';
            
            showStatus('âœ… window.name æ£€æµ‹å®Œæˆ', 'success');
        }

        function copyRealData() {
            if (!window.lastRealDataReport) {
                showStatus('âŒ è¯·å…ˆæ‰§è¡Œæ£€æµ‹', 'danger');
                return;
            }
            
            const jsonString = JSON.stringify(window.lastRealDataReport, null, 2);
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(jsonString).then(function() {
                    showStatus('âœ… æ£€æµ‹æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                }).catch(function(err) {
                    fallbackCopy(jsonString);
                });
            } else {
                fallbackCopy(jsonString);
            }
        }

        function clearAllData() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                // æ¸…é™¤æ‰€æœ‰ Cookie
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                showStatus('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
                readAllData();
            } catch (e) {
                showStatus('âŒ æ¸…ç©ºå¤±è´¥: ' + e.message, 'danger');
            }
        }

        function updatePageInfo() {
            const info = {
                'URL': window.location.href,
                'Origin': window.location.origin,
                'User Agent': navigator.userAgent,
                'æ—¶é—´æˆ³': new Date().toISOString(),
                'localStorage æ”¯æŒ': typeof(Storage) !== "undefined" ? 'æ˜¯' : 'å¦',
                'sessionStorage æ”¯æŒ': typeof(sessionStorage) !== "undefined" ? 'æ˜¯' : 'å¦'
            };
            document.getElementById('pageInfo').textContent = JSON.stringify(info, null, 2);
        }

        // å®šæœŸæ›´æ–°æ•°æ®ï¼ˆæ¯5ç§’ï¼‰
        setInterval(function() {
            readAllData();
        }, 5000);
    </script>
</body>
</html>
