<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>iframeå†…å®¹ï¼ˆwindow.nameæµ‹è¯•ï¼‰</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #e8f4f8;
        }
        .info {
            background: white;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h3>ğŸ–¼ï¸ è¿™æ˜¯åŒæºiframe</h3>
    <div class="info">
        <p><strong>å½“å‰originï¼š</strong><span id="origin"></span></p>
        <p><strong>window.nameï¼š</strong></p>
        <pre id="windowNameData">ï¼ˆç©ºï¼‰</pre>
        <p><strong>âš ï¸ æ³¨æ„ï¼š</strong>iframeçš„window.nameé€šå¸¸ç»§æ‰¿è‡ªçˆ¶é¡µé¢ï¼Œä½†æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸åŒã€‚</p>
    </div>

    <script>
        // æ˜¾ç¤ºå½“å‰origin
        document.getElementById('origin').textContent = window.location.origin;

        // è¯»å–window.name
        function readWindowName() {
            // å°è¯•å¤šç§æ–¹å¼è¯»å–window.name
            let windowName = '';
            
            // æ–¹å¼1ï¼šç›´æ¥è¯»å–
            try {
                windowName = window.name || '';
            } catch (e) {
                console.log('æ— æ³•ç›´æ¥è¯»å–window.name:', e);
            }
            
            // æ–¹å¼2ï¼šå°è¯•ä»çˆ¶é¡µé¢è¯»å–ï¼ˆå¦‚æœåŒæºï¼‰
            if (!windowName && window.parent !== window) {
                try {
                    windowName = window.parent.name || '';
                } catch (e) {
                    console.log('æ— æ³•ä»çˆ¶é¡µé¢è¯»å–window.nameï¼ˆå¯èƒ½æ˜¯è·¨æºï¼‰:', e);
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            if (windowName && windowName.trim() !== '') {
                try {
                    const bridgeContext = JSON.parse(windowName);
                    document.getElementById('windowNameData').textContent = 
                        JSON.stringify(bridgeContext, null, 2);
                } catch (e) {
                    document.getElementById('windowNameData').textContent = 
                        windowName.substring(0, 500);
                }
            } else {
                document.getElementById('windowNameData').textContent = 'ï¼ˆç©ºï¼‰';
            }
            
            // å‘é€ç»™çˆ¶é¡µé¢
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'windowNameData',
                    windowName: windowName
                }, '*');
            }
        }

        // æ¸…ç©ºwindow.name
        function clearWindowName() {
            window.name = '';
            readWindowName();
        }

        // ç›‘å¬çˆ¶é¡µé¢çš„æ¶ˆæ¯
        window.addEventListener('message', function(event) {
            if (event.data && event.data.action === 'readWindowName') {
                readWindowName();
            } else if (event.data && event.data.action === 'clearWindowName') {
                clearWindowName();
            }
        });

        // è‡ªåŠ¨è¯»å–
        readWindowName();
        
        // å®šæœŸæ›´æ–°ï¼ˆæ¯2ç§’ï¼‰
        setInterval(readWindowName, 2000);
    </script>
</body>
</html>
